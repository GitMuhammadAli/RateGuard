# ğŸ“ RateGuard Complete Learning Guide

> A comprehensive guide to understanding everything in this project, from NestJS architecture to rate limiting algorithms.

---

## ğŸ“‘ Table of Contents

1. [YouTube Learning Playlist](#-youtube-learning-playlist)
2. [NestJS Architecture Deep Dive](#1-nestjs-architecture-deep-dive)
3. [Monorepo & pnpm Deep Dive](#2-monorepo--pnpm-deep-dive)
4. [Docker Deep Dive](#3-docker-deep-dive)
5. [Prisma & Database Deep Dive](#4-prisma--database-deep-dive)
6. [JWT Authentication Deep Dive](#5-jwt-authentication-deep-dive)
7. [Rate Limiting Algorithms Deep Dive](#6-rate-limiting-algorithms-deep-dive)
8. [Redis Deep Dive](#7-redis-deep-dive)
9. [Learning Roadmap](#-your-learning-roadmap)

---

## ğŸ“º YouTube Learning Playlist

### NestJS (Backend Framework) â­ Start Here!

| Video                   | Channel           | Duration | Link                                                 |
| ----------------------- | ----------------- | -------- | ---------------------------------------------------- |
| NestJS in 100 Seconds   | Fireship          | 2 min    | [Watch](https://www.youtube.com/watch?v=0M8AYU_hPas) |
| NestJS Crash Course     | Traversy Media    | 1 hr     | [Watch](https://www.youtube.com/watch?v=GHTA143_b-s) |
| NestJS Full Course 2024 | FreeCodeCamp      | 3.5 hr   | [Watch](https://www.youtube.com/watch?v=GHTA143_b-s) |
| NestJS + Prisma + JWT   | Code With Antonio | 3 hr     | [Watch](https://www.youtube.com/watch?v=PppMe-GaYK0) |
| NestJS Folder Structure | Marius Espejo     | 20 min   | [Watch](https://www.youtube.com/watch?v=oYp9-mRcBVg) |

### Monorepo & Package Management

| Video                                         | Channel     | Duration | Link                                                 |
| --------------------------------------------- | ----------- | -------- | ---------------------------------------------------- |
| Monorepos - How the Pros Scale Huge Codebases | Fireship    | 8 min    | [Watch](https://www.youtube.com/watch?v=9iU_IE6vnJ8) |
| pnpm - Why it's Better                        | Theo        | 15 min   | [Watch](https://www.youtube.com/watch?v=ZIKDJBrk56k) |
| Turborepo in 100 Seconds                      | Fireship    | 3 min    | [Watch](https://www.youtube.com/watch?v=9iU_IE6vnJ8) |
| npm vs yarn vs pnpm                           | Coder Coder | 12 min   | [Watch](https://www.youtube.com/watch?v=r9b_TtBbRVg) |

### Docker

| Video                      | Channel             | Duration | Link                                                 |
| -------------------------- | ------------------- | -------- | ---------------------------------------------------- |
| Docker in 100 Seconds      | Fireship            | 2 min    | [Watch](https://www.youtube.com/watch?v=Gjnup-PuquQ) |
| Docker Crash Course        | Traversy Media      | 1 hr     | [Watch](https://www.youtube.com/watch?v=pTFZFxd4hOI) |
| Docker Compose Full Course | TechWorld with Nana | 2 hr     | [Watch](https://www.youtube.com/watch?v=SXwC9fSwct8) |
| Docker for Beginners       | FreeCodeCamp        | 3 hr     | [Watch](https://www.youtube.com/watch?v=fqMOX6JJhGo) |

### Database & Prisma

| Video                  | Channel            | Duration | Link                                                 |
| ---------------------- | ------------------ | -------- | ---------------------------------------------------- |
| Prisma in 100 Seconds  | Fireship           | 3 min    | [Watch](https://www.youtube.com/watch?v=rLRIB6AF2Dg) |
| Prisma Full Course     | Web Dev Simplified | 45 min   | [Watch](https://www.youtube.com/watch?v=RebA5J-rlwg) |
| PostgreSQL Full Course | FreeCodeCamp       | 4 hr     | [Watch](https://www.youtube.com/watch?v=qw--VYLpxG4) |
| Database Design Course | FreeCodeCamp       | 8 hr     | [Watch](https://www.youtube.com/watch?v=ztHopE5Wnpc) |

### JWT & Authentication

| Video                   | Channel            | Duration | Link                                                 |
| ----------------------- | ------------------ | -------- | ---------------------------------------------------- |
| JWT Explained           | Web Dev Simplified | 15 min   | [Watch](https://www.youtube.com/watch?v=7Q17ubqLfaM) |
| Session vs Token Auth   | Fireship           | 7 min    | [Watch](https://www.youtube.com/watch?v=UBUNrFtufWo) |
| OAuth 2.0 Explained     | ByteByteGo         | 10 min   | [Watch](https://www.youtube.com/watch?v=ZV5yTm4pT8g) |
| Bcrypt Password Hashing | Computerphile      | 9 min    | [Watch](https://www.youtube.com/watch?v=O6cmuiTBZVs) |

### Rate Limiting (Core Feature!)

| Video                       | Channel        | Duration | Link                                                 |
| --------------------------- | -------------- | -------- | ---------------------------------------------------- |
| Rate Limiting System Design | ByteByteGo     | 8 min    | [Watch](https://www.youtube.com/watch?v=FU4WlwfS3G0) |
| Token Bucket Explained      | ByteByteGo     | 5 min    | [Watch](https://www.youtube.com/watch?v=9CIjoWPwAhU) |
| System Design Interview     | Exponent       | 20 min   | [Watch](https://www.youtube.com/watch?v=mhUQe4BKZXs) |
| API Rate Limiting Deep Dive | Hussein Nasser | 25 min   | [Watch](https://www.youtube.com/watch?v=9CIjoWPwAhU) |

### Redis

| Video                 | Channel             | Duration | Link                                                 |
| --------------------- | ------------------- | -------- | ---------------------------------------------------- |
| Redis in 100 Seconds  | Fireship            | 2 min    | [Watch](https://www.youtube.com/watch?v=G1rOthIU-uo) |
| Redis Crash Course    | Traversy Media      | 40 min   | [Watch](https://www.youtube.com/watch?v=jgpVdJB2sKQ) |
| Redis Full Course     | FreeCodeCamp        | 2 hr     | [Watch](https://www.youtube.com/watch?v=XCsS_NVAa1g) |
| Redis Data Structures | TechWorld with Nana | 1 hr     | [Watch](https://www.youtube.com/watch?v=OqCK95AS-YE) |

### Next.js & React

| Video                    | Channel            | Duration | Link                                                 |
| ------------------------ | ------------------ | -------- | ---------------------------------------------------- |
| Next.js in 100 Seconds   | Fireship           | 3 min    | [Watch](https://www.youtube.com/watch?v=Sklc_fQBmcs) |
| Next.js 14 Full Course   | JavaScript Mastery | 5 hr     | [Watch](https://www.youtube.com/watch?v=wm5gMKuwSYk) |
| Zustand State Management | Jack Herrington    | 20 min   | [Watch](https://www.youtube.com/watch?v=_ngCLZ5Iz-0) |
| React Query / TanStack   | Theo               | 30 min   | [Watch](https://www.youtube.com/watch?v=novnyCaa7To) |

### System Design (Big Picture)

| Video                       | Channel             | Duration | Link                                                 |
| --------------------------- | ------------------- | -------- | ---------------------------------------------------- |
| System Design for Beginners | ByteByteGo          | 1 hr     | [Watch](https://www.youtube.com/watch?v=m8Icp_Cid5o) |
| API Gateway Pattern         | ByteByteGo          | 8 min    | [Watch](https://www.youtube.com/watch?v=6ULyxuHKxg8) |
| Microservices Explained     | TechWorld with Nana | 20 min   | [Watch](https://www.youtube.com/watch?v=rv4LlmLmVWk) |
| Load Balancing              | ByteByteGo          | 6 min    | [Watch](https://www.youtube.com/watch?v=sCR3SAVdyCc) |

---

## 1. NestJS Architecture Deep Dive

### Our Project Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RATEGUARD SERVER STRUCTURE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  apps/server/src/                                                           â”‚
â”‚  â”œâ”€â”€ auth/                    # ğŸ” Authentication Module                    â”‚
â”‚  â”‚   â”œâ”€â”€ controller/          # HTTP endpoints (REST API)                   â”‚
â”‚  â”‚   â”‚   â””â”€â”€ auth.controller.ts                                            â”‚
â”‚  â”‚   â”œâ”€â”€ service/             # Business logic                              â”‚
â”‚  â”‚   â”‚   â””â”€â”€ auth.service.ts                                               â”‚
â”‚  â”‚   â”œâ”€â”€ guards/              # Route protection                            â”‚
â”‚  â”‚   â”‚   â””â”€â”€ jwt-auth.guard.ts                                             â”‚
â”‚  â”‚   â”œâ”€â”€ strategies/          # Passport strategies                         â”‚
â”‚  â”‚   â”‚   â””â”€â”€ jwt.strategy.ts                                               â”‚
â”‚  â”‚   â”œâ”€â”€ dto/                 # Data Transfer Objects                       â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ login.dto.ts                                                  â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ register.dto.ts                                               â”‚
â”‚  â”‚   â”‚   â””â”€â”€ index.ts                                                      â”‚
â”‚  â”‚   â””â”€â”€ auth.module.ts       # Module definition                           â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ user/                    # ğŸ‘¤ User Management                          â”‚
â”‚  â”‚   â”œâ”€â”€ controller/                                                        â”‚
â”‚  â”‚   â”œâ”€â”€ service/                                                           â”‚
â”‚  â”‚   â”œâ”€â”€ dto/                                                               â”‚
â”‚  â”‚   â””â”€â”€ user.module.ts                                                     â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ system/                  # ğŸ”§ Global System Utilities                  â”‚
â”‚  â”‚   â”œâ”€â”€ decorator/           # Custom decorators                           â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ public.decorator.ts     # @Public() - skip auth               â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ current-user.decorator.ts # @CurrentUser()                    â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ throttle.decorator.ts   # @Throttle() - rate limit            â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ permissions.decorator.ts # @Permissions()                     â”‚
â”‚  â”‚   â”‚   â””â”€â”€ roles.decorator.ts      # @Roles()                            â”‚
â”‚  â”‚   â”œâ”€â”€ filter/              # Exception filters                           â”‚
â”‚  â”‚   â”‚   â””â”€â”€ http-exception.filter.ts                                      â”‚
â”‚  â”‚   â”œâ”€â”€ guard/               # Global guards                               â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ permissions.guard.ts                                          â”‚
â”‚  â”‚   â”‚   â””â”€â”€ roles.guard.ts                                                â”‚
â”‚  â”‚   â”œâ”€â”€ interceptor/         # Request/Response transformers               â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ logging.interceptor.ts                                        â”‚
â”‚  â”‚   â”‚   â””â”€â”€ transform.interceptor.ts                                      â”‚
â”‚  â”‚   â”œâ”€â”€ helper/              # Utility functions                           â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ crypto.helper.ts                                              â”‚
â”‚  â”‚   â”‚   â””â”€â”€ date.helper.ts                                                â”‚
â”‚  â”‚   â”œâ”€â”€ validator/           # Custom validators                           â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ is-unique.validator.ts                                        â”‚
â”‚  â”‚   â”‚   â””â”€â”€ match.validator.ts                                            â”‚
â”‚  â”‚   â””â”€â”€ module/              # Reusable modules                            â”‚
â”‚  â”‚       â””â”€â”€ email/           # Email service                               â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ database/                # ğŸ’¾ Database Layer                           â”‚
â”‚  â”‚   â”œâ”€â”€ prisma.service.ts    # Prisma client wrapper                      â”‚
â”‚  â”‚   â””â”€â”€ database.module.ts   # Global database module                      â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ cron/                    # â° Scheduled Tasks                           â”‚
â”‚  â”‚   â”œâ”€â”€ session-cleanup.service.ts                                        â”‚
â”‚  â”‚   â””â”€â”€ cron.module.ts                                                     â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ i18n/                    # ğŸŒ Internationalization                     â”‚
â”‚  â”‚   â”œâ”€â”€ en/common.json                                                     â”‚
â”‚  â”‚   â””â”€â”€ fr/common.json                                                     â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ config/                  # âš™ï¸ Configuration                            â”‚
â”‚  â”‚   â””â”€â”€ configuration.ts     # Environment config                          â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ app.module.ts            # ğŸ  Root module                              â”‚
â”‚  â”œâ”€â”€ main.ts                  # ğŸš€ Entry point                              â”‚
â”‚  â””â”€â”€ swagger.ts               # ğŸ“š API documentation                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why This Structure?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHY FEATURE-BASED ORGANIZATION?                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  âŒ BAD: Type-based (all controllers together)                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                â”‚
â”‚                                                                             â”‚
â”‚  src/                                                                       â”‚
â”‚  â”œâ”€â”€ controllers/                                                           â”‚
â”‚  â”‚   â”œâ”€â”€ auth.controller.ts                                                â”‚
â”‚  â”‚   â”œâ”€â”€ user.controller.ts      Problem: Related files are scattered!     â”‚
â”‚  â”‚   â””â”€â”€ workspace.controller.ts                                           â”‚
â”‚  â”œâ”€â”€ services/                                                              â”‚
â”‚  â”‚   â”œâ”€â”€ auth.service.ts         When working on auth, you jump between    â”‚
â”‚  â”‚   â”œâ”€â”€ user.service.ts         controllers/, services/, dto/ folders     â”‚
â”‚  â”‚   â””â”€â”€ workspace.service.ts                                              â”‚
â”‚  â””â”€â”€ dto/                                                                   â”‚
â”‚      â”œâ”€â”€ login.dto.ts                                                       â”‚
â”‚      â””â”€â”€ register.dto.ts                                                    â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  âœ… GOOD: Feature-based (auth module contains all auth files)               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•               â”‚
â”‚                                                                             â”‚
â”‚  src/                                                                       â”‚
â”‚  â”œâ”€â”€ auth/                       Everything about auth is HERE              â”‚
â”‚  â”‚   â”œâ”€â”€ controller/             âœ“ Easy to find                             â”‚
â”‚  â”‚   â”œâ”€â”€ service/                âœ“ Easy to understand scope                 â”‚
â”‚  â”‚   â”œâ”€â”€ dto/                    âœ“ Easy to test in isolation               â”‚
â”‚  â”‚   â”œâ”€â”€ guards/                 âœ“ Easy to extract to separate service     â”‚
â”‚  â”‚   â””â”€â”€ auth.module.ts                                                     â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ user/                       Everything about users is HERE             â”‚
â”‚  â”‚   â”œâ”€â”€ controller/                                                        â”‚
â”‚  â”‚   â”œâ”€â”€ service/                                                           â”‚
â”‚  â”‚   â”œâ”€â”€ dto/                                                               â”‚
â”‚  â”‚   â””â”€â”€ user.module.ts                                                     â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â””â”€â”€ system/                     Shared utilities used by ALL modules       â”‚
â”‚      â”œâ”€â”€ decorator/                                                         â”‚
â”‚      â”œâ”€â”€ filter/                                                            â”‚
â”‚      â””â”€â”€ guard/                                                             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### NestJS Core Concepts

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       NESTJS REQUEST LIFECYCLE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  HTTP Request arrives:  POST /api/v1/auth/login                             â”‚
â”‚                                                                             â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. MIDDLEWARE                                                       â”‚    â”‚
â”‚  â”‚    helmet(), compression(), cors()                                  â”‚    â”‚
â”‚  â”‚    â€¢ Runs on EVERY request                                          â”‚    â”‚
â”‚  â”‚    â€¢ Configures security headers, compression                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2. GUARDS                                                           â”‚    â”‚
â”‚  â”‚    JwtAuthGuard, RolesGuard, PermissionsGuard                       â”‚    â”‚
â”‚  â”‚    â€¢ Return true/false (allow or block)                             â”‚    â”‚
â”‚  â”‚    â€¢ Check: Is user authenticated? Has permission?                  â”‚    â”‚
â”‚  â”‚    â€¢ @Public() decorator skips JwtAuthGuard                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 3. INTERCEPTORS (Before)                                            â”‚    â”‚
â”‚  â”‚    LoggingInterceptor - records start time                          â”‚    â”‚
â”‚  â”‚    â€¢ Can transform request                                          â”‚    â”‚
â”‚  â”‚    â€¢ Wraps the entire route handler                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 4. PIPES (Validation)                                               â”‚    â”‚
â”‚  â”‚    ValidationPipe transforms { email, password }                    â”‚    â”‚
â”‚  â”‚    â€¢ Validates against DTO (LoginDto)                               â”‚    â”‚
â”‚  â”‚    â€¢ Throws 400 Bad Request if invalid                              â”‚    â”‚
â”‚  â”‚    â€¢ class-validator decorators (@IsEmail, @MinLength)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 5. CONTROLLER                                                       â”‚    â”‚
â”‚  â”‚    @Post('login') â†’ AuthController.login(dto)                       â”‚    â”‚
â”‚  â”‚    â€¢ Route handler method                                           â”‚    â”‚
â”‚  â”‚    â€¢ Uses @Body(), @Param(), @Query() decorators                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 6. SERVICE                                                          â”‚    â”‚
â”‚  â”‚    AuthService.login() - business logic                             â”‚    â”‚
â”‚  â”‚    â€¢ Database queries via PrismaService                             â”‚    â”‚
â”‚  â”‚    â€¢ Password verification, token generation                        â”‚    â”‚
â”‚  â”‚    â€¢ Returns data to controller                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 7. INTERCEPTORS (After)                                             â”‚    â”‚
â”‚  â”‚    LoggingInterceptor - logs duration                               â”‚    â”‚
â”‚  â”‚    TransformInterceptor - wraps response                            â”‚    â”‚
â”‚  â”‚    â€¢ Can transform response                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 8. EXCEPTION FILTER (if error thrown)                               â”‚    â”‚
â”‚  â”‚    HttpExceptionFilter catches all errors                           â”‚    â”‚
â”‚  â”‚    â€¢ Formats error response                                         â”‚    â”‚
â”‚  â”‚    â€¢ Logs error details                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  HTTP Response: { accessToken, refreshToken, user }                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Code Deep Dive: Module

```typescript
// auth/auth.module.ts
// A MODULE is a container that groups related code

import { Module } from "@nestjs/common";
import { JwtModule } from "@nestjs/jwt";
import { PassportModule } from "@nestjs/passport";
import { ConfigService } from "@nestjs/config";
import { AuthController } from "./controller/auth.controller";
import { AuthService } from "./service/auth.service";
import { JwtStrategy } from "./strategies/jwt.strategy";
import { DatabaseModule } from "../database/database.module";
import { EmailModule } from "../system/module/email/email.module";

@Module({
  imports: [
    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ IMPORTS = Other modules this module needs                      â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    DatabaseModule, // Provides PrismaService
    EmailModule, // Provides EmailService
    PassportModule.register({ defaultStrategy: "jwt" }),
    JwtModule.registerAsync({
      inject: [ConfigService],
      useFactory: (configService: ConfigService) => ({
        secret: configService.getOrThrow<string>("jwt.secret"),
        signOptions: { expiresIn: "15m" },
      }),
    }),
  ],

  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ CONTROLLERS = HTTP route handlers                              â”‚
  // â”‚ NestJS creates instances and routes requests to them           â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  controllers: [AuthController],

  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ PROVIDERS = Injectable services (Dependency Injection)         â”‚
  // â”‚ NestJS creates ONE instance, injects where needed              â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  providers: [AuthService, JwtStrategy],

  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ EXPORTS = What other modules can use from THIS module          â”‚
  // â”‚ If not exported, it's private to this module                   â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  exports: [AuthService, JwtStrategy, JwtModule],
})
export class AuthModule {}
```

### Code Deep Dive: Controller

```typescript
// auth/controller/auth.controller.ts
// CONTROLLER handles HTTP requests and returns responses

import {
  Controller,
  Post,
  Body,
  HttpCode,
  HttpStatus,
  Req,
} from "@nestjs/common";
import { ApiTags, ApiOperation, ApiResponse } from "@nestjs/swagger";
import { Request } from "express";
import { AuthService } from "../service/auth.service";
import { LoginDto, RegisterDto } from "../dto";
import { Public } from "../../system/decorator/public.decorator";
import { Throttle } from "../../system/decorator/throttle.decorator";

@ApiTags("Auth") // Swagger grouping
@Controller("auth") // Route prefix: /auth
export class AuthController {
  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ DEPENDENCY INJECTION                                           â”‚
  // â”‚ NestJS automatically creates and injects AuthService           â”‚
  // â”‚ No `new AuthService()` needed!                                 â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  constructor(private readonly authService: AuthService) {}

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // POST /api/v1/auth/register
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  @Public() // Skip JWT authentication (it's for guests!)
  @Post("register") // HTTP method + route
  @ApiOperation({ summary: "Register a new user" })
  @ApiResponse({ status: 201, description: "User registered successfully" })
  async register(
    @Body() dto: RegisterDto, // Request body â†’ validated by ValidationPipe
    @Req() req: Request // Raw Express request (for IP, headers)
  ) {
    const ipAddress = req.ip || req.socket.remoteAddress;
    const userAgent = req.headers["user-agent"];

    // Delegate to service (controller should be thin!)
    return this.authService.register(dto, ipAddress, userAgent);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // POST /api/v1/auth/login
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  @Public()
  @Post("login")
  @HttpCode(HttpStatus.OK) // Return 200 instead of default 201 for POST
  @Throttle(5, 60) // 5 attempts per 60 seconds (rate limit)
  async login(@Body() dto: LoginDto, @Req() req: Request) {
    const ipAddress = req.ip;
    const userAgent = req.headers["user-agent"];
    return this.authService.login(dto, ipAddress, userAgent);
  }
}
```

### Code Deep Dive: Service

```typescript
// auth/service/auth.service.ts
// SERVICE contains the business logic

import {
  Injectable,
  UnauthorizedException,
  ConflictException,
} from "@nestjs/common";
import { JwtService } from "@nestjs/jwt";
import * as bcrypt from "bcrypt";
import * as crypto from "crypto";
import { PrismaService } from "../../database/prisma.service";
import { EmailService } from "../../system/module/email/email.service";
import { RegisterDto, LoginDto } from "../dto";

@Injectable() // Makes this injectable (Dependency Injection)
export class AuthService {
  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ DEPENDENCY INJECTION                                           â”‚
  // â”‚ All dependencies are injected via constructor                  â”‚
  // â”‚ NestJS resolves them from the IoC container                    â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  constructor(
    private readonly prisma: PrismaService, // Database
    private readonly jwtService: JwtService, // JWT handling
    private readonly configService: ConfigService, // Config values
    private readonly emailService: EmailService // Email sending
  ) {}

  async register(dto: RegisterDto, ipAddress?: string) {
    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ STEP 1: Check if user exists                                   â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    const existingUser = await this.prisma.user.findUnique({
      where: { email: dto.email.toLowerCase() },
    });

    if (existingUser) {
      // Throw HTTP exception (caught by ExceptionFilter)
      throw new ConflictException("Email already registered");
    }

    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ STEP 2: Hash password                                          â”‚
    // â”‚ NEVER store plain text passwords!                              â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    const passwordHash = await bcrypt.hash(dto.password, 12);
    // 12 = cost factor (2^12 = 4096 iterations)

    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ STEP 3: Create user in database (transaction)                  â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    const user = await this.prisma.user.create({
      data: {
        email: dto.email.toLowerCase(),
        passwordHash,
        fullName: dto.fullName,
      },
    });

    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ STEP 4: Generate JWT tokens                                    â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    const tokens = await this.generateTokenPair(user.id, user.email, ipAddress);

    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ STEP 5: Send verification email                                â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    await this.emailService.sendVerificationEmail(
      user.email,
      user.fullName,
      token
    );

    return { user, tokens };
  }
}
```

### Code Deep Dive: DTO

```typescript
// auth/dto/register.dto.ts
// DTO = Data Transfer Object (validates incoming data)

import {
  IsEmail,
  IsNotEmpty,
  IsString,
  MinLength,
  MaxLength,
  Matches,
} from "class-validator";
import { ApiProperty } from "@nestjs/swagger";

export class RegisterDto {
  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ @ApiProperty = Swagger documentation                           â”‚
  // â”‚ @IsEmail = class-validator validation                          â”‚
  // â”‚ @IsNotEmpty = cannot be empty/null/undefined                   â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  @ApiProperty({ example: "john@example.com" })
  @IsEmail({}, { message: "Please provide a valid email address" })
  @IsNotEmpty()
  email: string;

  // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  // â”‚ PASSWORD VALIDATION                                            â”‚
  // â”‚ Multiple validators combine (all must pass)                    â”‚
  // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  @ApiProperty({ example: "SecurePass123!" })
  @IsString()
  @MinLength(8, { message: "Password must be at least 8 characters" })
  @MaxLength(128)
  @Matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/, {
    message: "Password must contain uppercase, lowercase, and number",
  })
  password: string;

  @ApiProperty({ example: "John Doe" })
  @IsString()
  @IsNotEmpty()
  @MinLength(2)
  @MaxLength(100)
  fullName: string;
}

// When ValidationPipe receives invalid data:
// {
//   "statusCode": 400,
//   "message": ["Password must be at least 8 characters"],
//   "error": "Bad Request"
// }
```

### Code Deep Dive: Guard

```typescript
// auth/guards/jwt-auth.guard.ts
// GUARD decides if request is allowed to proceed

import {
  Injectable,
  ExecutionContext,
  UnauthorizedException,
} from "@nestjs/common";
import { Reflector } from "@nestjs/core";
import { AuthGuard } from "@nestjs/passport";
import { IS_PUBLIC_KEY } from "../../system/decorator/public.decorator";

@Injectable()
export class JwtAuthGuard extends AuthGuard("jwt") {
  constructor(private reflector: Reflector) {
    super();
  }

  canActivate(context: ExecutionContext) {
    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ CHECK FOR @Public() DECORATOR                                  â”‚
    // â”‚ Reflector reads metadata set by decorators                     â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    const isPublic = this.reflector.getAllAndOverride<boolean>(IS_PUBLIC_KEY, [
      context.getHandler(), // Check method decorator
      context.getClass(), // Check class decorator
    ]);

    if (isPublic) {
      return true; // Skip authentication for public routes
    }

    // Otherwise, use Passport JWT strategy
    return super.canActivate(context);
  }

  handleRequest(err: any, user: any, info: any) {
    if (err || !user) {
      throw err || new UnauthorizedException("Authentication required");
    }
    return user; // Attach user to request.user
  }
}
```

### Code Deep Dive: Decorator

```typescript
// system/decorator/public.decorator.ts
// DECORATOR adds metadata to classes/methods

import { SetMetadata } from "@nestjs/common";

// Unique key for this metadata
export const IS_PUBLIC_KEY = "isPublic";

// The decorator function
export const Public = () => SetMetadata(IS_PUBLIC_KEY, true);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOW IT WORKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// When you use @Public() on a route:
//
// @Public()
// @Post('login')
// async login() { ... }
//
// It's equivalent to:
// Reflect.defineMetadata('isPublic', true, login);
//
// Then guards can read this metadata:
// const isPublic = this.reflector.get('isPublic', context.getHandler());
// if (isPublic) { skip authentication }
```

---

## 2. Monorepo & pnpm Deep Dive

### What is a Monorepo?

A **monorepo** (monolithic repository) is a single Git repository containing multiple projects/packages.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MONOREPO vs POLYREPO                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  POLYREPO (Multiple repositories)          MONOREPO (Single repository)    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ rateguard-serverâ”‚  Separate repo         â”‚ rateguard/                  â”‚ â”‚
â”‚  â”‚   package.json  â”‚                        â”‚   â”œâ”€â”€ apps/                 â”‚ â”‚
â”‚  â”‚   src/          â”‚                        â”‚   â”‚   â”œâ”€â”€ server/           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚   â”‚   â”‚   â””â”€â”€ package.json  â”‚ â”‚
â”‚                                             â”‚   â”‚   â””â”€â”€ client/           â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚   â”‚       â””â”€â”€ package.json  â”‚ â”‚
â”‚  â”‚ rateguard-clientâ”‚  Separate repo         â”‚   â”œâ”€â”€ package.json          â”‚ â”‚
â”‚  â”‚   package.json  â”‚                        â”‚   â””â”€â”€ pnpm-workspace.yaml   â”‚ â”‚
â”‚  â”‚   src/          â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                             âœ… Single git clone            â”‚
â”‚  âŒ Multiple git clones                     âœ… Shared dependencies          â”‚
â”‚  âŒ Version sync nightmare                  âœ… Atomic commits               â”‚
â”‚  âŒ Scattered changes                       âœ… Easy refactoring             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Our Workspace Configuration

```yaml
# pnpm-workspace.yaml
packages:
  - "apps/*" # apps/server and apps/client
```

```json
// Root package.json
{
  "name": "rateguard",
  "private": true,
  "packageManager": "pnpm@9.15.0",
  "scripts": {
    "dev": "concurrently -n server,client -c blue,green \"pnpm dev:server\" \"pnpm dev:client\"",
    "dev:server": "pnpm --filter @rateguard/server run start:dev",
    "dev:client": "pnpm --filter @rateguard/client run dev",
    "build": "pnpm --recursive run build"
  }
}
```

### Key pnpm Commands

```bash
# Install all dependencies for all packages
pnpm install

# Run script in specific package
pnpm --filter @rateguard/server run start:dev
pnpm --filter @rateguard/client run dev

# Run both server and client concurrently
pnpm dev

# Add dependency to specific package
pnpm --filter @rateguard/server add bcrypt
pnpm --filter @rateguard/client add zustand

# Add dev dependency to root workspace
pnpm add -Dw typescript
```

---

## 3. Docker Deep Dive

### What is Docker?

Docker runs applications in **containers** - isolated environments with their own filesystem, network, and processes.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VM vs CONTAINER                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  VIRTUAL MACHINE                          CONTAINER                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                          â•â•â•â•â•â•â•â•â•                         â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚        Your App         â”‚              â”‚        Your App         â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚    Guest OS (Linux)     â”‚   Heavy!     â”‚      Container Runtime  â”‚ Light!â”‚
â”‚  â”‚        (2GB+)           â”‚              â”‚        (few MB)         â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚       Hypervisor        â”‚              â”‚         Docker          â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚   Host OS (Windows)     â”‚              â”‚   Host OS (Windows)     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â”‚  â€¢ Full OS per VM (heavy)                 â€¢ Shares host kernel (light)      â”‚
â”‚  â€¢ Minutes to start                       â€¢ Seconds to start                â”‚
â”‚  â€¢ GBs of memory                          â€¢ MBs of memory                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Docker Compose Explained

```yaml
# docker/compose.yml
services:
  # PostgreSQL Database
  postgres:
    image: postgres:16-alpine # Image from Docker Hub
    container_name: rateguard-postgres
    restart: unless-stopped
    ports:
      - "5432:5432" # HOST:CONTAINER port mapping
    environment:
      POSTGRES_USER: rateguard
      POSTGRES_PASSWORD: rateguard
      POSTGRES_DB: rateguard
    volumes:
      - postgres_data:/var/lib/postgresql/data # Persist data!
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U rateguard"]
      interval: 5s
      retries: 5

  # Redis Cache
  redis:
    image: redis:7-alpine
    container_name: rateguard-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]

volumes:
  postgres_data:
  redis_data:
```

### Key Docker Commands

```bash
# Start all services
pnpm docker:up

# Stop all services
pnpm docker:down

# Stop and DELETE all data
pnpm docker:reset

# View logs
pnpm docker:logs

# Enter container shell
docker exec -it rateguard-postgres psql -U rateguard
docker exec -it rateguard-redis redis-cli
```

---

## 4. Prisma & Database Deep Dive

### What is Prisma?

Prisma is an **ORM** (Object-Relational Mapper) - query databases using TypeScript instead of SQL.

```typescript
// RAW SQL
const result = await pool.query("SELECT * FROM users WHERE email = $1", [
  email,
]);

// PRISMA (Type-safe!)
const user = await prisma.user.findUnique({
  where: { email },
  include: { sessions: true }, // Auto-join!
});
// user.email is typed as string
// user.sessions is typed as Session[]
```

### Schema Explained

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())    // Primary key + auto UUID
  email         String    @unique                  // Unique constraint
  passwordHash  String    @map("password_hash")   // Column name in DB
  fullName      String    @map("full_name")

  createdAt     DateTime  @default(now())         // Auto timestamp
  updatedAt     DateTime  @updatedAt              // Auto update

  sessions      Session[]                          // One-to-many relation

  @@map("users")                                   // Table name
}

model Session {
  id           String    @id @default(uuid())
  userId       String    @map("user_id")
  refreshToken String    @unique @map("refresh_token")

  user         User      @relation(fields: [userId], references: [id])

  @@map("sessions")
}
```

### Key Prisma Commands

```bash
# Push schema to database (development)
pnpm db:push

# Create migration (production)
npx prisma migrate dev --name "add_users_table"

# Generate TypeScript client
pnpm db:generate

# Open visual database browser
pnpm db:studio
```

---

## 5. JWT Authentication Deep Dive

### JWT Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          JWT TOKEN STRUCTURE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyLTEyMyJ9.SflKxwRJSMeKKF2QT4fwpM       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚         HEADER                   PAYLOAD                 SIGNATURE          â”‚
â”‚                                                                             â”‚
â”‚  HEADER:                                                                    â”‚
â”‚  { "alg": "HS256", "typ": "JWT" }                                          â”‚
â”‚                                                                             â”‚
â”‚  PAYLOAD:                                                                   â”‚
â”‚  { "sub": "user-123", "email": "a@b.com", "exp": 1704068100 }              â”‚
â”‚                                                                             â”‚
â”‚  SIGNATURE:                                                                 â”‚
â”‚  HMACSHA256(header + payload, SECRET_KEY)                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dual Token System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ACCESS TOKEN vs REFRESH TOKEN                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                      ACCESS TOKEN              REFRESH TOKEN                â”‚
â”‚                      â•â•â•â•â•â•â•â•â•â•â•â•              â•â•â•â•â•â•â•â•â•â•â•â•â•                â”‚
â”‚  Purpose:           Auth API requests         Get new access token         â”‚
â”‚  Lifetime:          15 minutes                7 days                        â”‚
â”‚  Stored in:         Memory/localStorage       localStorage + DB (hashed)   â”‚
â”‚  Sent with:         Every API request         Only /auth/refresh           â”‚
â”‚  If stolen:         15 min damage max         Detected & all revoked       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

See `AUTH_COMPLETE_GUIDE.md` for the complete authentication flow.

---

## 6. Rate Limiting Algorithms Deep Dive

### Why Rate Limit?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        WITHOUT vs WITH RATE LIMITING                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  WITHOUT:                              WITH:                                â”‚
â”‚  Attacker sends 10,000 req/sec         Server: "100 req/min allowed"        â”‚
â”‚  â†’ Server crashes                      â†’ 99.9% blocked                       â”‚
â”‚  â†’ Real users can't access             â†’ Server stays healthy               â”‚
â”‚  â†’ Huge cloud bill                     â†’ Costs controlled                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Token Bucket (Industry Standard)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TOKEN BUCKET ALGORITHM                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Config: max_tokens=10, refill_rate=1/second                                â”‚
â”‚                                                                             â”‚
â”‚  T=0:  [â—â—â—â—â—â—â—â—â—â—] 10/10 tokens (full bucket)                              â”‚
â”‚                                                                             â”‚
â”‚  T=0:  3 requests â†’ [â—â—â—â—â—â—â—â—‹â—‹â—‹] 7/10 âœ…                                    â”‚
â”‚                                                                             â”‚
â”‚  T=2:  +2 tokens  â†’ [â—â—â—â—â—â—â—â—â—â—‹] 9/10                                       â”‚
â”‚                                                                             â”‚
â”‚  T=2:  5 requests â†’ [â—â—â—â—â—‹â—‹â—‹â—‹â—‹â—‹] 4/10 âœ…                                    â”‚
â”‚                                                                             â”‚
â”‚  T=2:  8 requests â†’ [â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹] 0/10 â†’ 4 âœ…, 4 âŒ (429)                    â”‚
â”‚                                                                             â”‚
â”‚  Used by: AWS, Stripe, Cloudflare, GitHub                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Redis Deep Dive

### What is Redis?

Redis = **Remote Dictionary Server** - an in-memory data store.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL (Disk)                    Redis (RAM)                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚  Read: ~1-10ms                        Read: ~0.1ms (100x faster!)           â”‚
â”‚  Persistent forever                   Can persist (optional)                â”‚
â”‚  Complex queries                      Simple key-value                      â”‚
â”‚                                                                             â”‚
â”‚  Use for: Main data                   Use for: Cache, sessions,             â”‚
â”‚                                                rate limiting                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Data Structures

```bash
# STRING - Simple key-value
SET user:123:name "Ali"
GET user:123:name  # â†’ "Ali"
INCR page:views    # Atomic counter

# HASH - Object/Map
HSET user:123 name "Ali" email "a@b.com"
HGETALL user:123  # â†’ { name: "Ali", email: "a@b.com" }

# LIST - Queue
LPUSH jobs "job1"
RPOP jobs  # â†’ "job1"

# SORTED SET - Leaderboard
ZADD scores 100 "player1" 200 "player2"
ZREVRANGE scores 0 2  # Top 3
```

---

## ğŸ“… Your Learning Roadmap

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WEEKLY LEARNING PLAN                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  WEEK 1: Master NestJS Architecture                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                         â”‚
â”‚  â˜ Watch: NestJS Crash Course (Traversy, 1 hr)                              â”‚
â”‚  â˜ Watch: NestJS Folder Structure (Marius Espejo, 20 min)                   â”‚
â”‚  â˜ Practice: Trace a request through our auth module                        â”‚
â”‚  â˜ Practice: Add a new endpoint to user module                              â”‚
â”‚                                                                             â”‚
â”‚  WEEK 2: Database & Prisma                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                  â”‚
â”‚  â˜ Watch: Prisma Full Course (Web Dev Simplified, 45 min)                   â”‚
â”‚  â˜ Watch: Database Design Course (FreeCodeCamp, first 2 hrs)                â”‚
â”‚  â˜ Practice: Add a new model with relations                                 â”‚
â”‚  â˜ Practice: Write complex queries with include/select                      â”‚
â”‚                                                                             â”‚
â”‚  WEEK 3: Redis & Rate Limiting                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
â”‚  â˜ Watch: Redis Crash Course (Traversy, 40 min)                             â”‚
â”‚  â˜ Watch: Rate Limiting System Design (ByteByteGo)                          â”‚
â”‚  â˜ Watch: Token Bucket Explained (ByteByteGo)                               â”‚
â”‚  â˜ Build: Implement Token Bucket rate limiter                               â”‚
â”‚                                                                             â”‚
â”‚  WEEK 4: API Proxy & Logging                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                â”‚
â”‚  â˜ Learn: HTTP proxying concepts                                            â”‚
â”‚  â˜ Build: Proxy that forwards to external API                               â”‚
â”‚  â˜ Build: Request logging to database                                       â”‚
â”‚                                                                             â”‚
â”‚  WEEK 5: Analytics Dashboard                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                â”‚
â”‚  â˜ Build: Analytics endpoints (requests/day, etc.)                          â”‚
â”‚  â˜ Build: Dashboard charts with Recharts                                    â”‚
â”‚                                                                             â”‚
â”‚  WEEK 6: Polish & Deploy                                                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                  â”‚
â”‚  â˜ Add: Edge cases, error handling                                          â”‚
â”‚  â˜ Write: Unit tests                                                        â”‚
â”‚  â˜ Deploy: To Railway/Vercel                                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š Additional Resources

### Documentation

- [NestJS Docs](https://docs.nestjs.com/) - Official NestJS documentation
- [pnpm Workspaces](https://pnpm.io/workspaces)
- [Docker Compose](https://docs.docker.com/compose/)
- [Prisma Docs](https://www.prisma.io/docs)
- [Redis Docs](https://redis.io/docs/)

### Articles

- [Rate Limiting Fundamentals](https://blog.bytebytego.com/p/rate-limiting-fundamentals) - ByteByteGo
- [System Design Primer](https://github.com/donnemartin/system-design-primer) - GitHub

### Books

- "Designing Data-Intensive Applications" by Martin Kleppmann
- "System Design Interview" by Alex Xu

---

_Updated for the new NestJS folder structure - RateGuard Project_
